<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Surat Perjanjian Tempoan Resmi</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; max-width: 800px; margin: auto; padding:20px;}
  h2 { text-align:center; }
  label { display:block; margin-top:10px; font-weight:bold; }
  input, textarea { width:100%; padding:5px; margin-top:3px; }
  textarea { height:80px; }
  .ttd-container { display:flex; justify-content:space-between; margin-top:20px; }
  .ttd-box { border:1px solid #000; width:45%; height:150px; position:relative; }
  canvas { width:100%; height:100%; }
  button { margin-top:20px; padding:10px; width:100%; font-size:16px; cursor:pointer; }
</style>
</head>
<body>

<h2>Form Surat Perjanjian Tempoan</h2>

<label>Nama Perusahaan</label>
<input id="perusahaan">

<label>Nama Peminjam</label>
<input id="peminjam">

<label>Nama Pemberi Pinjaman</label>
<input id="pemberi">

<label>Jumlah Pinjaman</label>
<input id="jumlah" type="number">

<label>Persentase Bunga (%)</label>
<input id="bunga" type="number">

<label>Tanggal Pinjam</label>
<input id="tglPinjam" type="date">

<label>Tanggal Jatuh Tempo</label>
<input id="tglTempo" type="date">

<label>Keterangan</label>
<textarea id="keterangan"></textarea>

<h3>Tanda Tangan</h3>
<div class="ttd-container">
  <div class="ttd-box">
    <canvas id="ttdPeminjam"></canvas>
    <div style="position:absolute;bottom:0;left:0;width:100%;text-align:center;font-size:12px;">
      <b id="namaPeminjamTTD"></b>
    </div>
  </div>
  <div class="ttd-box">
    <canvas id="ttdPemberi"></canvas>
    <div style="position:absolute;bottom:0;left:0;width:100%;text-align:center;font-size:12px;">
      <b id="namaPemberiTTD"></b>
    </div>
  </div>
</div>

<button onclick="buatPDF()">Buat PDF Resmi</button>

<script>
function initCanvas(id){
  const canvas = document.getElementById(id);
  const ctx = canvas.getContext("2d");
  canvas.width = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;
  let drawing=false;
  canvas.addEventListener("mousedown",()=>drawing=true);
  canvas.addEventListener("mouseup",()=>{drawing=false;ctx.beginPath();});
  canvas.addEventListener("mouseleave",()=>drawing=false);
  canvas.addEventListener("mousemove",e=>{
    if(!drawing) return;
    const rect=canvas.getBoundingClientRect();
    ctx.lineWidth=2; ctx.lineCap="round"; ctx.strokeStyle="#000";
    ctx.lineTo(e.clientX-rect.left, e.clientY-rect.top);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(e.clientX-rect.left,e.clientY-rect.top);
  });
  return canvas;
}

const canvasPeminjam = initCanvas("ttdPeminjam");
const canvasPemberi = initCanvas("ttdPemberi");

async function buatPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const perusahaan = document.getElementById("perusahaan").value;
  const peminjam = document.getElementById("peminjam").value;
  const pemberi = document.getElementById("pemberi").value;
  const jumlah = parseFloat(document.getElementById("jumlah").value);
  const bunga = parseFloat(document.getElementById("bunga").value);
  const tglPinjam = document.getElementById("tglPinjam").value;
  const tglTempo = document.getElementById("tglTempo").value;
  const keterangan = document.getElementById("keterangan").value;

  document.getElementById("namaPeminjamTTD").innerText = peminjam;
  document.getElementById("namaPemberiTTD").innerText = pemberi;

  const totalBayar = jumlah + (jumlah*bunga/100);

  // HEADER SURAT
  doc.setFontSize(12); doc.setFont("helvetica","bold");
  doc.text(perusahaan.toUpperCase(),105,15,{align:"center"});
  doc.setFont("helvetica","normal"); doc.setFontSize(10);
  const headerLines=[
    "Badan Hukum No.02/BH/DISKUKM/I/2004, tanggal 02 Januari 2004",
    "Ciheulang Tonggoh - Cibadak",
    "UPSP PARUNG KUDA",
    "Desa Babakan Pendeuy Parungkuda",
    "Telp. (0266) 532673"
  ];
  headerLines.forEach((line,i)=>doc.text(line,105,22+i*5,{align:"center"}));
  doc.setLineWidth(0.5); doc.line(10,50,200,50);

  // JUDUL SURAT
  doc.setFontSize(14); doc.setFont("helvetica","bold");
  doc.text("SURAT PERJANJIAN PINJAMAN",105,60,{align:"center"});

  // ISI SURAT
  doc.setFontSize(12); doc.setFont("helvetica","normal");
  let isi = `Pada hari ini, dibuat dan disepakati perjanjian antara:\n\n`+
  `Nama Perusahaan : ${perusahaan}\n`+
  `Nama Peminjam : ${peminjam}\n`+
  `Nama Pemberi Pinjaman : ${pemberi}\n\n`+
  `Pihak Pemberi Pinjaman memberikan pinjaman kepada pihak Peminjam sebesar Rp ${jumlah.toLocaleString()} dengan ketentuan bahwa pihak Peminjam wajib mengembalikan pinjaman tersebut beserta bunga yang disepakati sehingga total yang harus dibayarkan adalah Rp ${totalBayar.toLocaleString()}.\n\n`+
  `Tanggal Pinjam : ${tglPinjam}\nTanggal Jatuh Tempo : ${tglTempo}\n\n`+
  `Keterangan :\n${keterangan}\n\n`+
  `Demikian surat perjanjian ini dibuat untuk dipergunakan sebagaimana mestinya dan mengikat kedua belah pihak.`;

  const textLines = doc.splitTextToSize(isi,180);
  doc.text(textLines,15,75);

  // KOLOM TANDA TANGAN
  const ttdY = 250;
  const kolom1X = 20, kolom2X = 120;
  const boxWidth = 60, boxHeight = 30;

  doc.setFontSize(11);
  doc.text("Peminjam", kolom1X+boxWidth/2, ttdY-45,{align:"center"});
  doc.text("Pemberi Pinjaman", kolom2X+boxWidth/2, ttdY-45,{align:"center"});

  doc.setDrawColor(0);
  doc.rect(kolom1X, ttdY-40, boxWidth, boxHeight);
  doc.rect(kolom2X, ttdY-40, boxWidth, boxHeight);

  const imgPeminjam = canvasPeminjam.toDataURL("image/png");
  const imgPemberi = canvasPemberi.toDataURL("image/png");

  doc.addImage(imgPeminjam,"PNG",kolom1X,ttdY-40,boxWidth,boxHeight);
  doc.addImage(imgPemberi,"PNG",kolom2X,ttdY-40,boxWidth,boxHeight);

  doc.text(peminjam, kolom1X+boxWidth/2, ttdY+10,{align:"center"});
  doc.text(pemberi, kolom2X+boxWidth/2, ttdY+10,{align:"center"});

  doc.save("Surat_Perjanjian_Resmi.pdf");
}
</script>
</body>
</html>
